import{a as st,b as at,c as Nt,d as Vt}from"./chunk-ISY3Z2ME.js";import{Aa as yt,B as c,Ba as W,C as b,Ca as D,D as y,Da as Y,E as V,F as P,G as g,H as _,Ha as xt,I as dt,K as R,L as ft,O as l,Q as ht,Qa as ot,S as gt,Sa as St,Ta as z,U as h,Ua as J,V as m,Va as wt,Wa as Ft,Xa as Dt,Ya as K,Za as Et,_a as It,aa as a,ba as o,ca as nt,cb as Mt,da as j,db as kt,ea as H,eb as Tt,f as mt,fa as C,fb as At,g as S,ga as d,gb as Q,h as k,ha as p,hb as Ot,i as T,ia as B,ja as L,ka as U,l as et,la as u,ma as _t,n as A,na as G,o as O,oa as w,p as I,pa as $,qa as Ct,r as rt,ra as F,s as lt,sa as M,t as x,ta as vt,ua as bt,v as pt,w as ut,wa as q,x as N,y as v,z as it}from"./chunk-XPVSHVWV.js";var X=class{fromModel(t){if(t instanceof Date)return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()};if(typeof t=="string"){let n=new Date(t);return{day:n.getUTCDate(),month:n.getUTCMonth()+1,year:n.getUTCFullYear()}}return t}toModel(t){if(!t)return t;let n=new Date;return n.setUTCFullYear(t.year,t.month-1,t.day),n.setUTCHours(0,0,0,0),n}};var Pt=(()=>{let t=class t extends Q{constructor(){super(...arguments),this.DELIMITER="."}parse(r){if(r){let i=r.split(this.DELIMITER);return{day:parseInt(i[0],10),month:parseInt(i[1],10),year:parseInt(i[2],10)}}return null}format(r){return r?r.day+this.DELIMITER+r.month+this.DELIMITER+r.year:""}};t.\u0275fac=(()=>{let r;return function(s){return(r||(r=dt(t)))(s||t)}})(),t.\u0275prov=N({token:t,factory:t.\u0275fac});let e=t;return e})();var Rt=e=>t=>e.includes(t?.value?.trim())?null:{countryError:!0};function jt(e){return t=>t.value?S(t.value).pipe(O(300),x(n=>e.checkUser(n).pipe(I(1))),k(n=>n.isAvailable?null:{usernameError:!0}),A(()=>S(null)),I(1)):S({usernameError:!0})}var ct=function(e){return e.Ukraine="Ukraine",e.Poland="Poland",e.Australia="Australia",e.Austria="Austria",e.Nepal="Nepal",e.USA="USA",e.Mexico="Mexico",e}(ct||{});var Ht=(()=>{let t=class t{constructor(){this._http=c(xt)}checkUser(r){return this._http.post("/api/checkUsername",{username:r})}submitAllForms(r){return this._http.post("/api/submitForm",{formValue:r})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Z=new it("MATCHING_DATA"),tt=new it("SEARCH_TERM");var Bt=(()=>{let t=class t{transform(r,i){if(!i||!r)return r;let s=r.filter(E=>E.toString().toLocaleLowerCase().includes(i.toLocaleLowerCase()));return s?.length?s:null}};t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=P({name:"arrFilter",type:t,pure:!0,standalone:!0});let e=t;return e})();function Zt(e,t){if(e&1){let n=C();a(0,"li",4),d("click",function(){let i=g(n).$implicit,s=p(2);return _(s.select(i))}),u(1),o()}if(e&2){let n=t.$implicit;l(),G(" ",n," ")}}function te(e,t){if(e&1&&(j(0),h(1,Zt,2,1,"li",3),H()),e&2){let n=t.ngIf,r=p();l(),m("ngForOf",n)("ngForTrackBy",r.trackBy)}}function ee(e,t){e&1&&(a(0,"div",5),u(1,"No matching results."),o())}var Lt=(()=>{let t=class t{constructor(){this.dataset=c(Z,{optional:!0})??[],this.searchTerm$=c(tt,{optional:!0})??S(""),this.selectEvent=new ft}get selectedItem$(){return this.selectEvent.asObservable()}select(r){this.selectEvent.emit(r)}trackBy(r,i){return i}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-matching-list-wrapper"]],outputs:{selectEvent:"selectEvent"},decls:6,vars:7,consts:[["errorTemplate",""],[1,"list-group","w-100","list-group-flush"],[4,"ngIf","ngIfElse"],["class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"list-group-item","list-group-item-action",3,"click"],[1,"p-2","user-select-none"]],template:function(i,s){if(i&1&&(a(0,"ul",1),h(1,te,2,2,"ng-container",2),F(2,"async"),F(3,"arrFilter"),h(4,ee,2,0,"ng-template",null,0,bt),o()),i&2){let E=U(5);l(),m("ngIf",vt(3,4,s.dataset,M(2,2,s.searchTerm$)))("ngIfElse",E)}},dependencies:[W,D,Bt,Y],styles:["[_nghost-%COMP%]{display:flex;background-color:#fff;border:1px solid var(--bs-border-color);border-radius:var(--bs-border-radius);width:100%;max-height:10rem;overflow-y:auto}"],changeDetection:0});let e=t;return e})();var Ut=(()=>{let t=class t{constructor(){this._ngControl=c(J,{optional:!0}),this._viewContainerRef=c(gt),this._elementRef=c(R),this._customDropdownService=c(st),this._inputValue$=new mt(""),this._showOn="focus",this.dataset=[]}set showOn(r){this._showOn=r,this._addEventListenerByType()}get element(){return this._elementRef.nativeElement}get value$(){return this._inputValue$?.pipe(O(500),rt(),lt(1))}onInput(){this._inputValue$.next(this.element.value)}ngOnInit(){this.initOverlay(),this.initComponentPortal()}ngOnDestroy(){this._unsubscribeEvents()}initOverlay(){this._customDropdownService.createConnectedOverlayRef(this.element)}initComponentPortal(){let r=this._customDropdownService.createInjector([{provide:Z,useValue:this.dataset},{provide:tt,useValue:this.value$}],this._viewContainerRef.injector);this._customDropdownService.createComponentPortal(Lt,this._viewContainerRef,r)}triggerEventHandler(){this._triggerSub=T(this.element,this._showOn).pipe(k(()=>{let r=this.element.value;switch(this._showOn){case"input":this._toggleList(r);break;default:this._openList()}return this._customDropdownService.componentRef}),rt(),et(Boolean),x(r=>r.instance.selectedItem$)).subscribe(r=>{r&&this._updateControlAndClose(r)})}blurEventHandler(){this._blurSub=T(this.element,"blur").pipe(x(()=>T(document,"click").pipe(et(r=>{let i=r.target;return!this._isMatchingListClicked(i)&&!this._isInputClicked(i)}),ut(()=>this._customDropdownService.hideOverlay()),pt(r=>{let i=r.target;return this._isMatchingListClicked(i)||this._isInputClicked(i)})))).subscribe()}_openList(){this._customDropdownService.showOverlay(),this._customDropdownService.componentRef?.changeDetectorRef.markForCheck()}_toggleList(r){r&&!this._customDropdownService.overlayRef?.hasAttached()&&this._openList(),r||this._customDropdownService.hideOverlay()}_addEventListenerByType(){this._unsubscribeEvents(),this.triggerEventHandler(),this.blurEventHandler()}_updateControlAndClose(r){this._customDropdownService.hideOverlay(),this._ngControl?.control?.patchValue(r),this._inputValue$.next(r)}_isMatchingListClicked(r){return this._customDropdownService.componentRef?.location.nativeElement.contains(r)}_isInputClicked(r){return this.element.contains(r)}_unsubscribeEvents(){this._triggerSub?.unsubscribe(),this._blurSub?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=V({type:t,selectors:[["input","matchingDropdown",""]],hostBindings:function(i,s){i&1&&d("input",function(){return s.onInput()})},inputs:{dataset:"dataset",showOn:"showOn"},features:[w([st])]});let e=t;return e})();var Gt=(()=>{let t=class t{transform(r){return r.controls.filter(s=>s.invalid).length}};t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=P({name:"invalidFormsCount",type:t,pure:!1,standalone:!0});let e=t;return e})();var $t=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=y({type:t}),t.\u0275inj=v({});let e=t;return e})();var qt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=y({type:t}),t.\u0275inj=v({imports:[Tt,kt]});let e=t;return e})();var Wt=(()=>{let t=class t{constructor(){this._cd=c(q),this._ngControl=c(J,{optional:!0,self:!0}),this._renderer=c(ht),this._elementRef=c(R),this.span=null,this.errorMessage="Invalid value"}get element(){return this._elementRef.nativeElement}onBlur(){this._ngControl?.status==="PENDING"||this._ngControl?.status==="DISABLED"||this._toggleErrorMessageElement(this.controlInvalid)}get controlInvalid(){return this._ngControl?.control?.invalid&&(this._ngControl?.control?.touched||this._ngControl?.control?.dirty)||!1}ngOnInit(){this._controlValueChangesHandler()}ngOnDestroy(){this._sub?.unsubscribe()}_controlValueChangesHandler(){this._ngControl?.control?.statusChanges&&(this._sub=this._ngControl.control.statusChanges.subscribe(r=>{this._cd.markForCheck(),!(r==="PENDING"||r==="DISABLED")&&this._toggleErrorMessageElement(this.controlInvalid)}))}_toggleErrorMessageElement(r){!this.span&&r&&this._addElement(),this.span&&!r&&this._removeElement()}_addElement(){this.span=this._getSpanElement(this.errorMessage),this._renderer.insertBefore(this.element.parentNode,this.span,this.element.nextSibling)}_removeElement(){this._renderer.removeChild(this.element.parentNode,this.span),this.span=null}_getSpanElement(r){let i=this._renderer.createElement("span");return this._renderer.addClass(i,"validator-error-message"),this._renderer.addClass(i,"absolute"),this._renderer.setStyle(i,"top",this.element.offsetTop+this.element.offsetHeight+"px"),r&&this._renderer.setProperty(i,"textContent",r),i}};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=V({type:t,selectors:[["input","inputValidator",""]],hostBindings:function(i,s){i&1&&d("blur",function(){return s.onBlur()})},inputs:{errorMessage:"errorMessage"},standalone:!0});let e=t;return e})();var ne=[[["","formHeader",""]]],oe=["[formHeader]"];function se(e,t){if(e&1){let n=C();a(0,"div",2)(1,"div",3),L(2),o(),a(3,"div",4)(4,"span",5),u(5,"Country"),o(),nt(6,"input",6),o(),a(7,"div",4)(8,"span",5),u(9,"Username"),o(),nt(10,"input",7),o(),a(11,"div",4)(12,"span",5),u(13,"Birthday"),o(),a(14,"input",8,0),d("click",function(){g(n);let i=U(15);return _(i.toggle())}),o()()()}if(e&2){let n=p();m("formGroup",n.form),l(6),m("showOn",n.showDropdownOn)("dataset",n.countries),l(8),m("maxDate",n.ngbDate)}}var Yt=(()=>{let t=class t{constructor(){this.date=new Date,this.showDropdownOn="input",this.countries=[]}get ngbDate(){return{day:this.date.getUTCDate(),month:this.date.getUTCMonth()+1,year:this.date.getUTCFullYear()}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-info-form"]],inputs:{showDropdownOn:"showDropdownOn",form:"form",countries:"countries"},standalone:!0,features:[w([{provide:At,useClass:X},{provide:Q,useClass:Pt}]),$],ngContentSelectors:oe,decls:1,vars:1,consts:[["d","ngbDatepicker"],["class","d-flex flex-column gap-3 w-100",3,"formGroup",4,"ngIf"],[1,"d-flex","flex-column","gap-3","w-100",3,"formGroup"],[1,"d-flex","justify-content-end","align-items-center"],[1,"d-flex","flex-column","gap-1"],[1,"fs-6"],["type","text","customInput","","matchingDropdown","","inputValidator","","errorMessage","Please provide a correct Country","size","large","formControlName","country",1,"border","rounded-2",3,"showOn","dataset"],["type","text","customInput","","inputValidator","","size","large","errorMessage","Please provide a correct Username","formControlName","username",1,"border","rounded-2"],["ngbDatepicker","","placeholder","dd.mm.yyyy","customInput","","inputValidator","","size","large","errorMessage","Please provide a correct Birthday","formControlName","date",1,"form-control","border",3,"click","maxDate"]],template:function(i,s){i&1&&(B(ne),h(0,se,16,4,"div",1)),i&2&&m("ngIf",s.form)},dependencies:[qt,St,wt,Ft,Et,It,Vt,Ot,D,$t,Ut,Wt],styles:["[_nghost-%COMP%]{display:block;width:100%}"],changeDetection:0});let e=t;return e})();var ce=["*"],zt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-card"]],standalone:!0,features:[$],ngContentSelectors:ce,decls:2,vars:0,consts:[[1,"d-flex","p-3","border","rounded-2","w-100","h-100"]],template:function(i,s){i&1&&(B(),a(0,"div",0),L(1),o())},styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=t;return e})();var le=e=>[e];function pe(e,t){if(e&1){let n=C();a(0,"button",8),d("click",function(){g(n);let i=p(2);return _(i.startSubmission())}),u(1,"Submit all forms"),o()}if(e&2){let n=p(2);m("disabled",n.submitDisabled)}}function ue(e,t){if(e&1){let n=C();a(0,"button",9),d("click",function(){g(n);let i=p(2);return _(i.cancelSubmission())}),u(1,"Cancel"),o()}}function de(e,t){if(e&1&&(a(0,"div"),u(1),F(2,"async"),o()),e&2){let n=p(2);l(),_t(M(2,1,n.timer$))}}function fe(e,t){if(e&1&&(a(0,"div",10),u(1),o()),e&2){let n=t.ngIf;l(),G("Invalid forms: ",n,"")}}function he(e,t){if(e&1){let n=C();a(0,"app-card",11)(1,"app-info-form",12)(2,"div",13),d("click",function(){let i=g(n).index,s=p(2);return _(s.removeForm(i))}),u(3,"x"),o()()()}if(e&2){let n=t.$implicit,r=p(2);l(),m("form",n)("countries",r.countries)("showDropdownOn",r.settings().dropdownAppearance)}}function ge(e,t){if(e&1){let n=C();a(0,"app-card",14),d("click",function(){g(n);let i=p(2);return _(i.addForm())}),a(1,"div",15)(2,"div",16),u(3,"+"),o()()()}if(e&2){let n=p(2);m("ngClass",Ct(1,le,n.isFormSubmissionStarted?"cursor-wait":"cursor-pointer"))}}function _e(e,t){if(e&1&&(j(0),a(1,"div",1),h(2,pe,2,1,"button",2)(3,ue,2,0,"button",3)(4,de,3,3,"div",0)(5,fe,2,1,"div",4),F(6,"invalidFormsCount"),o(),a(7,"div",5),h(8,he,4,3,"app-card",6)(9,ge,4,3,"app-card",7),o(),H()),e&2){let n=p();l(2),m("ngIf",!n.isFormSubmissionStarted),l(),m("ngIf",n.isFormSubmissionStarted),l(),m("ngIf",n.isFormSubmissionStarted),l(),m("ngIf",(n.formArray.dirty||n.formArray.touched)&&M(6,7,n.formArray)),l(3),m("ngForOf",n.formArrayControls)("ngForTrackBy",n.formTrackBy),l(),m("ngIf",n.formArrayControls.length<n.settings().maxFormsCount)}}var Jt=(()=>{let t=class t{constructor(){this._cd=c(q),this._formEditorService=c(Ht),this._settingsService=c(Nt),this._formSubmissionUtilsService=c(at),this.settings=this._settingsService.settingsMini,this.isFormSubmissionStarted=!1,this.countries=Object.keys(ct),this.timer$=this._formSubmissionUtilsService.getTimerWatch(this.settings().formCancellableSeconds),this.formArray=new Mt([this._getNewFormGroup()])}get submitDisabled(){return this.formArray.status==="PENDING"||this.formArray.invalid||!this.formArrayControls.length||this.isFormSubmissionStarted}get formArrayControls(){return this.formArray.controls}ngOnInit(){this._submissionEventHandler()}ngOnDestroy(){this._submitSubscription?.unsubscribe()}formTrackBy(r,i){return"form_"+r}addForm(){this.formArrayControls.length===this.settings().maxFormsCount||this.isFormSubmissionStarted||this.formArray.push(this._getNewFormGroup())}removeForm(r){this.isFormSubmissionStarted||this.formArray.removeAt(r)}_getNewFormGroup(){return new Dt({country:new K("",[z.required,Rt(this.countries)]),username:new K("",{validators:[z.required],asyncValidators:[jt(this._formEditorService)]}),date:new K(null,[z.required])})}_submissionEventHandler(){this._submitSubscription=this._formSubmissionUtilsService.delayedEvent$.pipe(x(()=>this._formEditorService.submitAllForms(this.formArray.getRawValue()).pipe(I(1))),A(r=>{throw this.isFormSubmissionStarted=!1,r})).subscribe(()=>{this.isFormSubmissionStarted=!1,this.formArray.enable(),this.formArray.reset([]),this._cd.markForCheck()})}startSubmission(){this.formArray.invalid||(this.formArray.disable(),this.isFormSubmissionStarted=!0,this._formSubmissionUtilsService.emitWithDelay(this.settings().formCancellableSeconds))}cancelSubmission(){!this.isFormSubmissionStarted||!this._submitSubscription||(this.formArray.enable(),this.isFormSubmissionStarted=!1,this._submitSubscription?.unsubscribe(),this._submissionEventHandler())}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-multi-form"]],features:[w([at])],decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","align-items-center","mb-4","gap-2"],["type","button","class","btn btn-primary",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["class","fs-6 text-danger",4,"ngIf"],[1,"d-flex","flex-wrap","gap-2"],["class","square-block",4,"ngFor","ngForOf","ngForTrackBy"],["class","square-block align-self-stretch hover-card",3,"ngClass","click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button",1,"btn","btn-danger",3,"click"],[1,"fs-6","text-danger"],[1,"square-block"],[3,"form","countries","showDropdownOn"],["formHeader","",1,"cursor-pointer","user-select-none",3,"click"],[1,"square-block","align-self-stretch","hover-card",3,"click","ngClass"],[1,"d-flex","align-items-center","justify-content-center","w-100","h-100"],[1,"fs-1","border","square-block","h-4","rounded-circle","lh-1","d-flex","align-items-center","justify-content-center","user-select-none"]],template:function(i,s){i&1&&h(0,_e,10,9,"ng-container",0),i&2&&m("ngIf",s.settings())},dependencies:[Yt,zt,W,D,yt,Gt,Y],styles:["[_nghost-%COMP%]   .square-block[_ngcontent-%COMP%]{aspect-ratio:1/1}[_nghost-%COMP%]   app-card[_ngcontent-%COMP%]{min-height:320px}[_nghost-%COMP%]   .hover-card[_ngcontent-%COMP%]:hover{background-color:var(--bs-btn-hover-bg)}[_nghost-%COMP%]   .h-4[_ngcontent-%COMP%]{height:4rem}"],changeDetection:0});let e=t;return e})();var Ce=[{path:"",component:Jt},{path:"**",redirectTo:""}],Kt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=y({type:t}),t.\u0275inj=v({imports:[ot.forChild(Ce),ot]});let e=t;return e})();var hi=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=y({type:t}),t.\u0275inj=v({imports:[Kt]});let e=t;return e})();export{hi as FormEditorModule};
